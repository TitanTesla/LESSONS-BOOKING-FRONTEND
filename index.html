<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vue.js Lessons App</title>
    <!-- Vue.js library -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <!-- Font Awesome for cart icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <style>
      /* Minimal styling */
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .lesson {
        border: 1px solid #ddd;
        padding: 10px;
        margin: 10px 0;
        width: 30%;
      }
      .form-group {
        margin-bottom: 10px;
      }
      button {
        padding: 8px 16px;
        margin-top: 10px;
      }
      header,
      header > button,
      header > label {
        padding: 10px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header>
        <!-- App title -->
        <h1>{{ sitename }}</h1>
        <!-- Button to toggle cart view; disabled if cart is empty -->
        <button v-on:click="toggleCheckout" :disabled="cartItemCount === 0">
          {{ cartItemCount }} <span class="fas fa-cart-plus"></span> View Cart
        </button>
        <!-- Sorting options for lessons -->
        <div>
          <label for="sort">Sort by:</label>
          <select v-model="sortAttribute" id="sort">
            <option value="subject">Subject</option>
            <option value="location">Location</option>
            <option value="price">Price</option>
            <option value="spaces">Spaces</option>
          </select>
          <label for="order">Order:</label>
          <select v-model="sortOrder" id="order">
            <option value="ascending">Ascending</option>
            <option value="descending">Descending</option>
          </select>
        </div>
      </header>
       <!-- Lessons list displayed if not viewing cart -->
       <main v-if="!showCheckout">
        <div v-for="lesson in sortedLessons" :key="lesson._id" class="lesson">
          <!-- Lesson details -->
          <img
            :src="`http://localhost:3000/images/${lesson.image}`"
            alt="Lesson Image"
            style="width: 100%; height: auto"
          />
          <h2>{{ lesson.subject }}</h2>
          <p>Location: {{ lesson.location }}</p>
          <p>Price: ${{ lesson.price }}</p>
          <p>Spaces Available: {{ lesson.spaces }}</p>
          <!-- Button to add a lesson to cart; disabled if no spaces available -->
          <button v-on:click="addToCart(lesson)" :disabled="lesson.spaces <= 0">
            Add to Cart
          </button>
        </div>
      </main>
       <!-- Cart and Checkout view -->
       <div v-if="showCheckout">
        <h2>Your Cart</h2>
        <!-- Display all items in the cart -->
        <div
          v-for="(lesson, index) in cart"
          :key="lesson._id"
          class="cart-item"
        >
          <p><strong>Subject:</strong> {{ lesson.subject }}</p>
          <p><strong>Location:</strong> {{ lesson.location }}</p>
          <p><strong>Price:</strong> ${{ lesson.price }}</p>
          <p><strong>Spaces:</strong> {{ lesson.spaces }}</p>
          <!-- Button to remove item from cart -->
          <button v-on:click="removeFromCart(index)">Remove</button>
        </div>
        <!-- Button to close the cart view -->
        <button v-on:click="toggleCheckout">Close Cart</button>
        <!-- Checkout form -->
        <h2>Checkout</h2>
        <div class="form-group">
          <label for="name">Name:</label>
          <input
            v-model="order.name"
            id="name"
            type="text"
            placeholder="Your Name"
            @input="validateInputs"
          />
        </div>
        <div class="form-group">
          <label for="phone">Phone:</label>
          <input
            v-model="order.phone"
            id="phone"
            type="text"
            placeholder="Your Phone"
            @input="validateInputs"
          />
        </div>
        <!-- Submit order button; disabled if form is invalid -->
        <button v-on:click="submitOrder" :disabled="!isFormValid">
          Submit Order
        </button>
      </div>
    </div>
    <script>
      new Vue({
        el: '#app',
        data: {
          sitename: 'Lessons Booking App', // Application name
          lessons: [], // Array to store lessons data
          cart: [], // Array to store cart items
          showCheckout: false, // Boolean to toggle checkout view
          order: { name: '', phone: '' }, // Object for storing user input in checkout
          isFormValid: false, // Boolean to track form validation
          sortAttribute: 'subject', // Attribute for sorting lessons
          sortOrder: 'ascending' // Sorting order
        },
        computed: {
          // Calculate number of items in the cart
          cartItemCount() {
            return this.cart.length
          },
          // Sort lessons based on selected attribute and order
          sortedLessons() {
            let sorted = [...this.lessons].sort((a, b) => {
              if (
                this.sortAttribute === 'price' ||
                this.sortAttribute === 'spaces'
              ) {
                return a[this.sortAttribute] - b[this.sortAttribute]
              }
              return a[this.sortAttribute].localeCompare(b[this.sortAttribute])
            })
            if (this.sortOrder === 'descending') {
              sorted.reverse()
            }
            return sorted
          }
        },
        methods: {
          // Fetch lessons data from the server
          async fetchLessons() {
            const response = await fetch('http://localhost:3000/lessons')
            this.lessons = await response.json()
          },

         
      })
    </script>
  </body>
</html>
